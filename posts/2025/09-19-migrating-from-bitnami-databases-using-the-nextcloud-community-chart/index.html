<!doctype html>
<html class="not-ready lg:text-base" lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
  <!-- Title -->
  <title>
    Migrating from Bitnami to Official PostgreSQL Images with the Nextcloud Community Chart - JWSCHMAN
  </title>

  <!-- Meta -->
  <meta name="theme-color" />

  
  <!-- Author -->
  
  <!---->
  
  <!---->
  
  <!---->
  
  <!---->
  
  <!---->
  <meta name="description" content="A step-by-step guide to migrating from Bitnami PostgreSQL images to official PostgreSQL" />
  <meta name="author" content="JW" />
  <!-- The Open Graph protocol -->
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Migrating from Bitnami to Official PostgreSQL Images with the Nextcloud Community Chart" />
  <meta property="og:site_name" content="JWSCHMAN" />
  <meta property="og:description" content="A step-by-step guide to migrating from Bitnami PostgreSQL images to official PostgreSQL" />
  <meta property="og:url" content="https:&#x2F;&#x2F;jwschman.github.io&#x2F;posts&#x2F;2025&#x2F;09-19-migrating-from-bitnami-databases-using-the-nextcloud-community-chart&#x2F;" />
  
  <!---->
  
  <!---->
  
  <!---->
  
  <meta property="og:image" content="https://jwschman.github.io/cover-image.png" />
  
  <!---->
  

  <!-- CSS & JS -->
  <link rel="preload stylesheet" as="style" href="https://jwschman.github.io/main.css" />
  <style>
    :root {
      --bg: #f4f4f5;
      --bg-dark: #18181b;
      --header: #e4e4e7;
      --header-dark: #27272a;
    }
  </style>

  <!-- Image Centering and Table Style Added by jwschman-->
  
  <link rel="stylesheet" href="https://jwschman.github.io/imagestyle.css" />
  <link rel="stylesheet" href="https://jwschman.github.io/tablestyle.css" />
  <link rel="stylesheet" href="https://jwschman.github.io/style.css" />


  

  <!-- Dark Icon -->
  <link rel="preload" as="image" href="https://jwschman.github.io/icons/theme.svg" />

  <!-- Math -->
  
  <!---->

  <!-- Mermaid -->
  
  <!---->

  <!-- Favicon -->
  <!-- Path changed by jwschman -->
  <link rel="icon" href="https://jwschman.github.io/icons/favicon.ico" />
  <link rel="apple-touch-icon" href="https://jwschman.github.io/apple-touch-icon.png" />

  <!-- Feeds -->
  

  <!-- Canonical -->
  <link rel="canonical" href="https:&#x2F;&#x2F;jwschman.github.io&#x2F;posts&#x2F;2025&#x2F;09-19-migrating-from-bitnami-databases-using-the-nextcloud-community-chart&#x2F;" />
</head>

  <body class="text-black duration-200 ease-out dark:text-white">
    <header
  class="header fixed top-0 z-40 mx-auto min-h-[3.5rem] w-full"
>
  <div class="mx-auto w-full max-w-4xl p-3 lg:flex lg:justify-between">
    <div class="flex justify-between">
      <div class="flex items-center">
        <a class="text-2xl font-semibold" href="https://jwschman.github.io">JWSCHMAN</a>
        <div
          class="btn-dark ml-4 h-6 w-6 shrink-0 cursor-pointer text-[0] [background:url(./icons/theme.svg)_left_center/cover_no-repeat] dark:invert dark:[background-position:right]"
          role="button"
          aria-label="Dark"
        ></div>
      </div>
      
      <div
        class="btn-menu relative z-50 flex h-8 w-8 shrink-0 cursor-pointer flex-col items-center justify-center gap-2.5 lg:hidden"
        role="button"
        aria-label="Menu"
      ></div>
      
    </div>
    <script>
      // base
      const htmlClass = document.documentElement.classList;
      setTimeout(() => {
        htmlClass.remove("not-ready");
      }, 10);

      // mobile menu
      const btnMenu = document.querySelector(".btn-menu");
      btnMenu?.addEventListener("click", () => {
        htmlClass.toggle("open");
      });

      // dark theme
      const setDark = (isDark) => {
        if (isDark) {
          document.body.dispatchEvent(new CustomEvent("set-theme", { detail: "dark" }));
          htmlClass.add("dark");
        } else {
          document.body.dispatchEvent(new CustomEvent("set-theme", { detail: "light" }));
          htmlClass.remove("dark");
        }
        localStorage.setItem("dark", isDark);
      };

      // init
      const darkScheme = window.matchMedia("(prefers-color-scheme: dark)");
      if (htmlClass.contains("dark")) {
        setDark(true);
      } else {
        const darkVal = localStorage.getItem("dark");
        setDark(darkVal ? darkVal === "true" : darkScheme.matches);
      }

      // listen system
      darkScheme.addEventListener("change", (event) => {
        setDark(event.matches);
      });

      // manual switch
      const btnDark = document.querySelector(".btn-dark");
      btnDark.addEventListener("click", () => {
        setDark(localStorage.getItem("dark") !== "true");
      });
    </script>
    
    <nav class="flex w-full items-center lg:w-auto">
      <ul
        class="nav-wrapper flex w-full flex-col py-2 lg:w-auto lg:flex-row lg:self-center lg:py-0"
      >
        
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://jwschman.github.io"
            >home</a
          >
        </li>
        
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://jwschman.github.io/posts"
            >posts</a
          >
        </li>
        
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://jwschman.github.io/projects"
            >projects</a
          >
        </li>
        
        <li>
          <a
            class="primary-link block py-2 text-center text-lg font-medium lg:px-3 lg:py-0"
            href="https://jwschman.github.io/contact"
            >contact</a
          >
        </li>
        
      </ul>
      <!-- Header Nav inject -->
      
    </nav>
    
  </div>
</header>


    <!-- Body Start inject -->
    

    <main
      class="prose prose-neutral relative mx-auto min-h-[calc(100%-9rem)] max-w-3xl break-words px-4 pb-16 pt-32 dark:prose-invert prose-pre:rounded-lg prose-img:rounded-lg"
    >

    
<article>
  <header class="mb-16">
    <h1 class="!my-0 pb-2.5">Migrating from Bitnami to Official PostgreSQL Images with the Nextcloud Community Chart</h1>
    <div class="text-sm antialiased opacity-60">
  
  <time>2025-09-19</time>
  <!---->
  <!---->
  <!---->
  <!---->
  
  <span class="mx-1">&middot;</span>
  <span>JW</span>
  
</div>

  </header>

  <!---->
  <figure class="mb-12 mt-0">
    <img
      class="h-auto w-full rounded-lg"
      src="https://jwschman.github.io/posts/2025/09-19-migrating-from-bitnami-databases-using-the-nextcloud-community-chart/cover-image.png"
      alt="cover"
    />
  </figure>
  

  <!-- Content -->
  <section><p>Bitnami Helm Charts have moved to a subscription model that is significantly out of my budget so I had to do some cleanup in my Homelab cluster to get rid of any Bitnami images that I was using.</p>
<p>Fortunately it wasn't many.  I was using the Bitnami chart for my centralized Redis instance, but that was easy enough to swap out with the official image.  But the Nextcloud Community Chart uses Bitnami images for databases, so I needed to move away from those.</p>
<p>First I disabled the Bitnami Redis instance included in the Nextcloud helm chart and pointed it towards my new Redis server in the <code>values.yaml</code>.</p>
<pre data-lang="yaml" style="background-color:#282a36;color:#f8f8f2;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6;">redis</span><span>:
</span><span>  </span><span style="color:#ff79c6;">enabled</span><span>: </span><span style="color:#bd93f9;">false
</span><span style="color:#ff79c6;">externalRedis</span><span>:
</span><span>  </span><span style="color:#ff79c6;">enabled</span><span>: </span><span style="color:#bd93f9;">true
</span><span>  </span><span style="color:#6272a4;">## Redis host
</span><span>  </span><span style="color:#ff79c6;">host</span><span>: </span><span style="color:#f1fa8c;">&quot;redis-svc.redis.svc.cluster.local&quot;
</span><span>  </span><span style="color:#6272a4;">## Redis port
</span><span>  </span><span style="color:#ff79c6;">port</span><span>: </span><span style="color:#f1fa8c;">&quot;6379&quot;
</span><span>  </span><span style="color:#6272a4;">## Use an existing secret
</span><span>  </span><span style="color:#ff79c6;">existingSecret</span><span>:
</span><span>    </span><span style="color:#ff79c6;">enabled</span><span>: </span><span style="color:#bd93f9;">true
</span><span>    </span><span style="color:#ff79c6;">secretName</span><span>: </span><span style="color:#f1fa8c;">nextcloud-redis-secrets
</span><span>    </span><span style="color:#ff79c6;">passwordKey</span><span>: </span><span style="color:#f1fa8c;">password
</span></code></pre>
<p>The second database was Postgres, which was going to be a little bit of work.  So let's see how I did it...</p>
<h2 id="prerequisites">Prerequisites</h2>
<ul>
<li>Ability to execute into pods with <code>kubectl</code></li>
<li>Nextcloud and Postgres instances running in the <code>nextcloud</code> namespace (you can modify commands to match your namespace if it's different)</li>
<li>A backup of all Nextcloud data before starting would also be a good idea</li>
</ul>
<h2 id="step-1-get-the-new-instance-of-postgres-up-and-running">Step 1: Get the new instance of Postgres up and running</h2>
<p>Setting up a Postgres instance in Kubernetes is quite easy.  The only caveat here was that I had to prepare it for the Nextcloud migration, but that was simply setting a couple environment variables in the manifest.  Here's how it looks:</p>
<pre data-lang="yaml" style="background-color:#282a36;color:#f8f8f2;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span>---
</span><span style="color:#ff79c6;">apiVersion</span><span>: </span><span style="color:#f1fa8c;">apps/v1
</span><span style="color:#ff79c6;">kind</span><span>: </span><span style="color:#f1fa8c;">Deployment
</span><span style="color:#ff79c6;">metadata</span><span>:
</span><span>  </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgresql
</span><span style="color:#ff79c6;">spec</span><span>:
</span><span>  </span><span style="color:#ff79c6;">selector</span><span>:
</span><span>    </span><span style="color:#ff79c6;">matchLabels</span><span>:
</span><span>      </span><span style="color:#ff79c6;">app</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgresql
</span><span>  </span><span style="color:#ff79c6;">replicas</span><span>: </span><span style="color:#bd93f9;">1
</span><span>  </span><span style="color:#ff79c6;">template</span><span>:
</span><span>    </span><span style="color:#ff79c6;">metadata</span><span>:
</span><span>      </span><span style="color:#ff79c6;">labels</span><span>:
</span><span>        </span><span style="color:#ff79c6;">app</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgresql
</span><span>    </span><span style="color:#ff79c6;">spec</span><span>:
</span><span>      </span><span style="color:#ff79c6;">containers</span><span>:
</span><span>      - </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">postgres
</span><span>        </span><span style="color:#ff79c6;">image</span><span>: </span><span style="color:#f1fa8c;">postgres:17 </span><span style="color:#6272a4;"># Use whatever version tag you want
</span><span>        </span><span style="color:#ff79c6;">ports</span><span>:
</span><span>        - </span><span style="color:#ff79c6;">containerPort</span><span>: </span><span style="color:#bd93f9;">5432
</span><span>          </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">tcp-postgres
</span><span>        
</span><span>        </span><span style="color:#ff79c6;">env</span><span>:
</span><span>        - </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">POSTGRES_DB </span><span style="color:#6272a4;"># nextcloud database name
</span><span>          </span><span style="color:#ff79c6;">value</span><span>: </span><span style="color:#f1fa8c;">nextcloud
</span><span>        - </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">POSTGRES_USER </span><span style="color:#6272a4;"># nextcloud username
</span><span>          </span><span style="color:#ff79c6;">valueFrom</span><span>:
</span><span>            </span><span style="color:#ff79c6;">secretKeyRef</span><span>:
</span><span>              </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">nextcloud-db-secret
</span><span>              </span><span style="color:#ff79c6;">key</span><span>: </span><span style="color:#f1fa8c;">username
</span><span>        - </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">POSTGRES_PASSWORD
</span><span>          </span><span style="color:#ff79c6;">valueFrom</span><span>:
</span><span>            </span><span style="color:#ff79c6;">secretKeyRef</span><span>:
</span><span>              </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">nextcloud-db-secret
</span><span>              </span><span style="color:#ff79c6;">key</span><span>: </span><span style="color:#f1fa8c;">password
</span><span>        
</span><span>        - </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">PGDATA </span><span style="color:#6272a4;"># postgres data directory
</span><span>          </span><span style="color:#ff79c6;">value</span><span>: </span><span style="color:#f1fa8c;">/var/lib/postgresql/data/pgdata
</span><span>        
</span><span>        </span><span style="color:#ff79c6;">volumeMounts</span><span>:
</span><span>        - </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgres-data
</span><span>          </span><span style="color:#ff79c6;">mountPath</span><span>: </span><span style="color:#f1fa8c;">/var/lib/postgresql/data
</span><span>
</span><span>      </span><span style="color:#ff79c6;">volumes</span><span>:
</span><span>        - </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgres-data
</span><span>          </span><span style="color:#ff79c6;">persistentVolumeClaim</span><span>:
</span><span>            </span><span style="color:#ff79c6;">claimName</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgres-data
</span><span>---
</span><span style="color:#ff79c6;">apiVersion</span><span>: </span><span style="color:#f1fa8c;">v1
</span><span style="color:#ff79c6;">kind</span><span>: </span><span style="color:#f1fa8c;">Service
</span><span style="color:#ff79c6;">metadata</span><span>:
</span><span>  </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgresql-svc
</span><span>  </span><span style="color:#ff79c6;">labels</span><span>:
</span><span>    </span><span style="color:#ff79c6;">app</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgresql
</span><span style="color:#ff79c6;">spec</span><span>:
</span><span>  </span><span style="color:#ff79c6;">ports</span><span>:
</span><span>  - </span><span style="color:#ff79c6;">port</span><span>: </span><span style="color:#bd93f9;">5432
</span><span>    </span><span style="color:#ff79c6;">name</span><span>: </span><span style="color:#f1fa8c;">tcp-postgres
</span><span>  </span><span style="color:#ff79c6;">selector</span><span>:
</span><span>    </span><span style="color:#ff79c6;">app</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgresql
</span></code></pre>
<p>You can see that I'm setting <code>POSTGRES_USER</code> and <code>POSTGRES_PASSWORD</code> from a secret that I already had created inside the nextcloud namespace, and just setting <code>POSTGRES_DB</code> to nextcloud.</p>
<p>The persistent data is also using a PVC named <code>nextcloud-postgres-data</code> created previously inside the nextcloud namespace.</p>
 <!---->


<div
  class="my-4 flex flex-col rounded-lg bg-[var(--admonition-bg)]"
  style="--admonition-bg: rgba(0, 191, 165, 0.1)"
>
  <div class="flex items-center rounded-t-lg bg-[var(--admonition-bg)] p-1">
    <div
      class="mx-2 h-4 w-4 text-[0] [background:var(--url)_center_center_no-repeat] dark:invert"
      style="--url: url(./icons/tip.svg)"
    >
      tip
    </div>
    <span><strong>tip</strong></span>
  </div>
  <div class="pl-4"><p>If you don't have a secret already you can easily create one with this:</p>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud create secret generic nextcloud-db-secret \
</span><span style="font-style:italic;color:#ffb86c;">  --from-literal</span><span style="color:#ff79c6;">=</span><span>username=nextcloud \
</span><span style="font-style:italic;color:#ffb86c;">  --from-literal</span><span style="color:#ff79c6;">=</span><span>password=my-totally-secure-password
</span></code></pre>
</div>
</div>
<p>And the service is just type ClusterIP named nextcloud-postgresql-svc</p>
 <!---->


<div
  class="my-4 flex flex-col rounded-lg bg-[var(--admonition-bg)]"
  style="--admonition-bg: rgba(255, 145, 0, 0.1)"
>
  <div class="flex items-center rounded-t-lg bg-[var(--admonition-bg)] p-1">
    <div
      class="mx-2 h-4 w-4 text-[0] [background:var(--url)_center_center_no-repeat] dark:invert"
      style="--url: url(./icons/warning.svg)"
    >
      warning
    </div>
    <span><strong>warning</strong></span>
  </div>
  <div class="pl-4"><p>I'm only running a single instance of Postgres and don't need high-availability or scalability so I went with a Deployment.  This is not recommended for a robust scalable production environment where you should use a StatefulSet with volumeClaimTemplates.</p>
</div>
</div>
<p>Once that was up and running it was time for the next step.</p>
<h2 id="step-2-migrate-the-postgres-data">Step 2: Migrate the Postgres data</h2>
<h3 id="put-nextcloud-in-maintenance-mode">Put Nextcloud in maintenance mode</h3>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud exec</span><span style="font-style:italic;color:#ffb86c;"> -it </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-pod</span><span style="color:#ff79c6;">&gt; </span><span>-- php occ maintenance:mode</span><span style="font-style:italic;color:#ffb86c;"> --on
</span></code></pre>
<h3 id="dump-the-postgres-nextcloud-database-to-local-machine">Dump the Postgres nextcloud database to local machine</h3>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud exec</span><span style="font-style:italic;color:#ffb86c;"> -it </span><span style="color:#ff79c6;">&lt;</span><span>bitnami-postgres-pod</span><span style="color:#ff79c6;">&gt; </span><span>-- pg_dump</span><span style="font-style:italic;color:#ffb86c;"> -U </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-username</span><span style="color:#ff79c6;">&gt; </span><span>-d </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-database-name</span><span style="color:#ff79c6;">&gt; &gt;</span><span> nextcloud.sql
</span></code></pre>
<h3 id="copy-the-local-nextcloud-sql-to-the-postgres-pod">Copy the local <code>nextcloud.sql</code> to the postgres pod</h3>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud cp ./nextcloud.sql </span><span style="color:#ff79c6;">&lt;</span><span>new-postgres-pod</span><span style="color:#ff79c6;">&gt;</span><span>:/tmp/nextcloud.sql
</span></code></pre>
<h3 id="restore-the-database-in-the-new-postgres-pod">Restore the database in the new Postgres pod</h3>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud exec</span><span style="font-style:italic;color:#ffb86c;"> -it </span><span style="color:#ff79c6;">&lt;</span><span>new-postgres-pod</span><span style="color:#ff79c6;">&gt; </span><span>-- psql</span><span style="font-style:italic;color:#ffb86c;"> -U </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-username</span><span style="color:#ff79c6;">&gt; </span><span>-d </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-database-name</span><span style="color:#ff79c6;">&gt; </span><span>-f /tmp/nextcloud.sql
</span></code></pre>
<h2 id="step-3-point-nextcloud-to-the-new-postgres-database">Step 3: Point Nextcloud to the new Postgres database</h2>
<p>I just edited the <code>values.yaml</code> to disable the Bitnami Postgres and use <code>externalDatabase</code> and pointed the details to my new Postgres service and secret</p>
<pre data-lang="yaml" style="background-color:#282a36;color:#f8f8f2;" class="language-yaml "><code class="language-yaml" data-lang="yaml"><span style="color:#ff79c6;">postgresql</span><span>:
</span><span>  </span><span style="color:#ff79c6;">enabled</span><span>: </span><span style="color:#bd93f9;">false
</span><span>
</span><span style="color:#ff79c6;">externalDatabase</span><span>:
</span><span>  </span><span style="color:#ff79c6;">enabled</span><span>: </span><span style="color:#bd93f9;">true
</span><span>  </span><span style="color:#ff79c6;">type</span><span>: </span><span style="color:#f1fa8c;">postgresql
</span><span>  </span><span style="color:#ff79c6;">host</span><span>: </span><span style="color:#f1fa8c;">nextcloud-postgresql-svc  </span><span style="color:#6272a4;"># New instance&#39;s service name
</span><span>  </span><span style="color:#ff79c6;">database</span><span>: </span><span style="color:#f1fa8c;">nextcloud
</span><span>  </span><span style="color:#ff79c6;">existingSecret</span><span>:
</span><span>    </span><span style="color:#ff79c6;">enabled</span><span>: </span><span style="color:#bd93f9;">true
</span><span>    </span><span style="color:#ff79c6;">secretName</span><span>: </span><span style="color:#f1fa8c;">nextcloud-db-secret
</span><span>    </span><span style="color:#ff79c6;">usernameKey</span><span>: </span><span style="color:#f1fa8c;">username
</span><span>    </span><span style="color:#ff79c6;">passwordKey</span><span>: </span><span style="color:#f1fa8c;">password
</span></code></pre>
<p>After that you should be able to apply the Helm chart with the updated values and be good to go with the new database.</p>
<p>ArgoCD manages my helm deployments, but you may need to apply the helm chart with a command like this:</p>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#50fa7b;">helm</span><span> upgrade nextcloud nextcloud/nextcloud</span><span style="font-style:italic;color:#ffb86c;"> -f</span><span> values.yaml</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud
</span></code></pre>
 <!---->


<div
  class="my-4 flex flex-col rounded-lg bg-[var(--admonition-bg)]"
  style="--admonition-bg: rgba(255, 82, 82, 0.1)"
>
  <div class="flex items-center rounded-t-lg bg-[var(--admonition-bg)] p-1">
    <div
      class="mx-2 h-4 w-4 text-[0] [background:var(--url)_center_center_no-repeat] dark:invert"
      style="--url: url(./icons/failure.svg)"
    >
      failure
    </div>
    <span><strong>error: issue with Nextcloud&#x27;s config.php</strong></span>
  </div>
  <div class="pl-4"><p>After applying the Helm chart I found that it did not update the values of the <code>config.php</code> to the new database service.  This may be an issue with the Helm chart, the way the PVC is mounted, or maybe I didn't do something right.</p>
</div>
</div>
<h3 id="fixing-the-config-php-values">Fixing the <code>config.php</code> values</h3>
<p>I decided to just manually edit the <code>config.php</code> in the Nextcloud pod to the updated values.  vi and nano weren't available, but sed was, so I used that to update</p>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#6272a4;"># create a backup first
</span><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud exec</span><span style="font-style:italic;color:#ffb86c;"> -it </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-pod</span><span style="color:#ff79c6;">&gt; </span><span>-- cp /var/www/html/config/config.php /var/www/html/config/config.php.BAK
</span><span>
</span><span style="color:#6272a4;"># update dbhost
</span><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud exec</span><span style="font-style:italic;color:#ffb86c;"> -it </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-pod</span><span style="color:#ff79c6;">&gt; </span><span>-- sed</span><span style="font-style:italic;color:#ffb86c;"> -i </span><span style="color:#f1fa8c;">&quot;s/&#39;dbhost&#39; =&gt; &#39;.*&#39;/&#39;dbhost&#39; =&gt; &#39;nextcloud-postgresql-svc&#39;/&quot;</span><span> /var/www/html/config/config.php
</span></code></pre>
<p><strong>Replace <code>nextcloud-postgresql-svc</code> with whatever your service name for Postgres is.</strong></p>
<p>Then I just recreated the pod, waited for it to report that it was up, and then went to the domain it's hosted at and saw that it was still up and in maintenance mode.</p>
 <!---->


<div
  class="my-4 flex flex-col rounded-lg bg-[var(--admonition-bg)]"
  style="--admonition-bg: rgba(0, 191, 165, 0.1)"
>
  <div class="flex items-center rounded-t-lg bg-[var(--admonition-bg)] p-1">
    <div
      class="mx-2 h-4 w-4 text-[0] [background:var(--url)_center_center_no-repeat] dark:invert"
      style="--url: url(./icons/tip.svg)"
    >
      tip
    </div>
    <span><strong>tip</strong></span>
  </div>
  <div class="pl-4"><p>If you run into any errors here, check your nextcloud logs with:</p>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud exec</span><span style="font-style:italic;color:#ffb86c;"> -it </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-pod</span><span style="color:#ff79c6;">&gt; </span><span>-- less /var/www/html/data/nextcloud.log
</span></code></pre>
</div>
</div>
<h2 id="step-4-turn-off-maintenance-mode">Step 4: Turn off maintenance mode</h2>
<pre data-lang="bash" style="background-color:#282a36;color:#f8f8f2;" class="language-bash "><code class="language-bash" data-lang="bash"><span style="color:#50fa7b;">kubectl</span><span style="font-style:italic;color:#ffb86c;"> -n</span><span> nextcloud exec</span><span style="font-style:italic;color:#ffb86c;"> -it </span><span style="color:#ff79c6;">&lt;</span><span>nextcloud-pod</span><span style="color:#ff79c6;">&gt; </span><span>-- php occ maintenance:mode</span><span style="font-style:italic;color:#ffb86c;"> --off
</span></code></pre>
<h2 id="conclusion">Conclusion</h2>
<p>And with that you should be set up with your new Postgres instance that isn't using a Bitnami image.</p>
<p>Next week I'll likely write a post about migrating my Bitnami WordPress Helm chart deployment to native Kubernetes manifests also using Official Images.</p>
</section>

  <hr />

  <!-- Post Taxonomies -->
  
<footer class="mt-12 flex flex-col">
  <!---->
  <!---->
  <!---->
  <!---->
  
  <div class="mb-2 flex flex-wrap">
    <span class="block-bg mb-1.5 mr-1.5 rounded-lg px-5 py-1.5">Tags </span>
    
    <a
      class="block-bg block-hover mb-1.5 mr-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://jwschman.github.io/tags/nextcloud/"
      >nextcloud</a
    >
    
    <a
      class="block-bg block-hover mb-1.5 mr-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://jwschman.github.io/tags/bitnami/"
      >bitnami</a
    >
    
    <a
      class="block-bg block-hover mb-1.5 mr-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://jwschman.github.io/tags/postgres/"
      >postgres</a
    >
    
    <a
      class="block-bg block-hover mb-1.5 mr-1.5 rounded-lg px-5 py-1.5 no-underline"
      href="https://jwschman.github.io/tags/homelab/"
      >homelab</a
    >
    
  </div>
  
</footer>

<!---->

  <!-- Post Nav -->
  
<nav class="block-bg mt-12 flex flex-wrap rounded-lg text-lg">
  
  <a
    class="block-hover-mask flex min-w-[50%] grow items-center rounded-l-md p-6 pr-3 font-semibold no-underline"
    href="https:&#x2F;&#x2F;jwschman.github.io&#x2F;posts&#x2F;2025&#x2F;09-02-site-update&#x2F;"
    ><span class="mr-1.5">←</span><span>Site update</span></a
  >
  <!---->
  
  <a
    class="block-hover-mask ml-auto flex min-w-[50%] grow items-center justify-end rounded-r-md p-6 pl-3 font-semibold no-underline"
    href="https:&#x2F;&#x2F;jwschman.github.io&#x2F;posts&#x2F;2025&#x2F;09-24-migrating-wordpress-from-the-bitnami-helm-chart-to-kubernetes-manifests&#x2F;"
    ><span>Migrating WordPress from Bitnami Helm Charts to Official Images</span><span class="ml-1.5">→</span></a
  >
  
</nav>

<!---->

  <!-- Comment -->
  
</article>


    </main>

    <footer class="mx-auto flex max-w-3xl flex-wrap items-center px-8 py-4 text-sm opacity-60">
  <div class="mr-auto basis-full lg:basis-1/2">
    <!---->
    <!---->
    &copy; 2024 - 2025<!---->
    
    <a class="link" href="https://jwschman.github.io">
      JW
    </a>
     |<!---->
    <!---->
    <a class="link" href="https:&#x2F;&#x2F;creativecommons.org&#x2F;licenses&#x2F;by-sa&#x2F;4.0&#x2F;deed" rel="noopener" target="_blank">
      CC BY-SA 4.0
    </a>
    <!---->
    
  </div>
  <div class="flex basis-full lg:basis-1/2 lg:justify-end">
    <a class="link mr-6 lg:ml-6" href="https://www.getzola.org/" rel="noopener" target="_blank">
      Powered by Zola
    </a>
    <a class="link" href="https://github.com/st1020/kita" rel="noopener" target="_blank">✎ Kita</a>
  </div>
  <!-- Footer inject -->
  
</footer>


    <!-- Body End inject -->
    
  </body>
</html>
